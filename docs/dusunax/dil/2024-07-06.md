# Next.js 14 & React - ì™„ë²½ ê°€ì´ë“œ

> ìŠ¤í„°ë””: ì›”ê°„ CS, https://github.com/monthly-cs/2024-06-nextjs  
> ì‘ì„±ì¼: 2024-07-06
> ì‘ì„±ì: dusunax

---

## Page Routing ê¸°ì¤€

### ì •ì  ìƒì„± ì´ì–´ì„œ...

ì˜ˆì™¸ì²˜ë¦¬ ì¼ë°˜ì ì¸ ì¼€ì´ìŠ¤ => notFound, redirect í‚¤ë¥¼ return

- productsë¥¼ ì •ì  ìƒì„± ì˜ˆì‹œ

  ```tsx
  export async function getStaticProps(context) {
    ...

    if (!data) {
      return { redirect: { destination: "/no-data" } };
    }

    if (data.products.length === 0) {
      return { notFound: true };
    }

    return {
      props: {
        products: data.products,
      },
      revaildate: 60, // í˜ì´ì§€ê°€ êµ¬ì¶• & ë°°í¬ëœ ì´í›„ì—ë„ ê³„ì† ì¬ì„±ì„±í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •, ì´ˆ ë‹¨ìœ„
    };
  }
  ```

### params

- ì»´í¬ë„ŒíŠ¸ì—ì„œ paramsë¥¼ ì‚¬ìš©í•˜ë©´? ğŸ‘‰ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ëœë‹¤.
- getStaticPropsëŠ” ì„œë²„ì—ì„œ ì‹¤í–‰ëœë‹¤. ğŸ‘‰ ë°ì´í„°ë¥¼ ì‚¬ì „ ëœë”ë§ í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- product ì •ì  ìƒì„± ì˜ˆì‹œ

  ```tsx
  export async function getStaticProps(context) {
    const { params } = context;
    const productId = parmas.pid;

    const data = await getData();
    const product = data.products.find((product) => product.id === productId);

    if (!product) {
      return { notFound: true };
    }

    return {
      props: {
        loadedProduct: product,
      },
      revaildate: 60,
    };
  }
  ```

### ë™ì  í˜ì´ì§€ SSGë¥¼ ìœ„í•œ getStaticPath

- ë™ì  í˜ì´ì§€ì˜ defaultëŠ” ì‚¬ì „ ëœë”ë§ì´ ì•„ë‹ˆë‹¤. => í˜ì´ì§€ê°€ ì–¼ë§ˆë‚˜ ìƒì„±ë  ì§€ ëª¨ë¥¸ë‹¤. => ë§¤ ë²ˆ ìƒˆë¡œ ëœë”ë§
- getStaticPropsë¥¼ ì¶”ê°€ -> next.jsì—ê²Œ ì‚¬ì „ ëœë”ë§í•˜ê² ë‹¤!ë¥¼ ì•Œë¦¼
- getStaticPathë¥¼ í˜ì´ì§€ì— ì¶”ê°€í•œë‹¤.
  - ê²½ë¡œì— ëŒ€í•œ ì •ì  í˜ì´ì§€ ìƒì„±
    ```tsx
    export default async function getStaticPaths() {
      return {
        paths: {
          { params: { pid: "p1" } },
          { params: { pid: "p2" } },
        },
        fallback: false
      }
    }
    ```

### build time

- ë¹Œë“œëœ íŒŒì¼
  - ë°ì´í„° í”„ë¦¬íŒ¨ì¹˜: p1.json // pre patched data file
  - ì‚¬ì „ ìƒì„±ëœ í˜ì´ì§€: p1.html // will hydrate
- í˜ì´ì§€ ì‚¬ì „ ìƒì„±ì„ ìœ„í•œ ì‹œê°„ì´ ì†Œìš”ëœë‹¤.
  - ë§Œì•½ ì‚¬ì „ ìƒì„±ë˜ì–´ì•¼ í•  í˜ì´ì§€ê°€ ë§ë‹¤ë©´? ex) ì•„ë§ˆì¡´
  - ê±°ì˜ ë°©ë¬¸ë˜ì§€ ì•ŠëŠ” í˜ì´ì§€ê°€ ìˆë‹¤ë©´? -> ë¶ˆí•„ìš”í•  ìˆ˜ ìˆë‹¤.

### fallback: blocking

í˜ì´ì§€ë¥¼ ì„œë¸Œí•˜ê¸° ì „ì— ì‚¬ì „ ëœë”ë§ì´ ëë‚˜ê¸°ë¥¼ ê¸°ë‹¤ë¦°ë‹¤. ì‘ë‹µ ì§€ì—°ì´ ìƒê¸°ì§€ë§Œ, ì‚¬ì „ ëœë”ë§ì´ ì™„ë£Œëœ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤. ë¶ˆì™„ì „í•œ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ê³  ì‹¶ì§€ ì•Šì„ ê²½ìš°ì— ì‚¬ìš©í•œë‹¤.

í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ê°„ì— ë¡œë”© í™”ë©´ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ë©´, ë¬´ì¡°ê±´ ì™„ì„±ëœ í˜ì´ì§€ë¥¼ í•œ ë²ˆì— ë³´ì—¬ì£¼ëŠ” ì´ì ë³´ë‹¤ í˜ì´ì§€ê°€ ì¦‰ê°ì ìœ¼ë¡œ ì´ë™ë˜ì§€ ì•ŠëŠ” ì ì´ UX ì €í•˜ê°€ ëª…ë°±í•˜ë‹¤ê³  ìƒê°í•œë‹¤. ë¶ˆì™„ì „í•œ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ê³  ì‹¶ì§€ ì•Šì„ ê²½ìš° <- ì´ ê²½ìš°ê°€ ì–´ë–¤ ê²½ìš°ê°€ ìˆëŠ” ì§€ ê¶ê¸ˆí•´ì„œ chatGPTì—ê²Œ ë¬¼ì–´ë³´ì•˜ë”ë‹ˆ, ê¸ˆìœµ ì •ë³´, ê±´ê°• ë°ì´í„°, ë¹„ì¦ˆë‹ˆìŠ¤ ë³´ê³ ì„œ ê°™ì€ ë°ì´í„°ê°€ ì¤‘ìš”í•œ ì»¨í…ì¸ ë‚˜, ë””ìì¸ ì¼ê´€ì„±ì„ ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¥¼ ë§í•´ì¤€ë‹¤.

í™•ì‹¤íˆ ë§ì€ ì¢…ë¥˜ì˜ ì»¨í…ì¸ ë¥¼ ìœ„í•œ fallbackì„ ìœ„í•´ ìŠ¤ì¼ˆë ˆí†¤ì´ë‚˜ í”„ë¡œê·¸ë˜ìŠ¤ë°”, ìŠ¤í”¼ë„ˆ ë“±ì„ ë‚¨ë°œí•˜ë©´ ë””ìì¸ ì¼ê´€ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆê² ë‹¤ê³  ë‚©ë“ì´ ëœë‹¤. ì˜ˆì „ì´ë¼ë©´ ëˆ„êµ°ê°€ì—ê²Œ ë¬¼ì–´ë³´ì•˜ì–´ì•¼ í•  í…ë°, ì‚¬ëŒì˜ ê²½í—˜ ë§Œí¼ì€ ëª»í•˜ì§€ë§Œ ë­ë“ ì§€(ì¼ë‹¨) ëŒ€ë‹µí•´ì£¼ëŠ” chatGPTê°€ ìˆì–´ì„œ ì£¼ë‹ˆì–´ê°€ ì„±ì¥í•˜ê¸° ì¢‹ì€ ì‹œëŒ€ê°€ ëœ ê²ƒ ê°™ë‹¤.

### paths í•˜ë“œì½”ë”© ì§€ìš°ê¸°

```tsx
export default async function getStaticPaths() {
  const data = await getData();

  const ids = data.products.map((product) => product.id);
  const pathsWithParams = ids.map((id) => ({ params: { pid: id } }));

  return {
    paths: pathsWithParams,
    fallback: false,
  };
}
```

> í•¨ìˆ˜ì˜ code blockì€? í•¨ìˆ˜ ëª¸ì²´ function body

### fallback: true

ì‚¬ì „ ëœë”ë§ í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš° ë¡œë”© ìƒíƒœë¥¼ ì–´ë–»ê²Œ í‘œê¸°í•  ê²ƒì¸ê°€? ê·¸ë¦¬ê³  ë™ì ì¸ ë°ì´í„° ì†ŒìŠ¤ì—ì„œ ë°ì´í„°ê°€ ì—†ëŠ” í˜ì´ì§€ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ê°€?

- ë¡œë”© ì¤‘: fallback ì»´í¬ë„ŒíŠ¸
  - fallbackì„ trueë¡œ ì„¤ì •í•˜ë©´, ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‚¬ì „ ë Œë”ë§ì´ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë¡œë”© ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆìŒ
  - ë°±ê·¸ë¼ìš´ë“œ: getStaticPropsë¥¼ í˜¸ì¶œ -> ë°ì´í„° ê°€ì ¸ì˜´ -> í˜ì´ì§€ ëœë”ë§
- ë°ì´í„° ì—†ìŒ: `{ notFound: true }`
  - getStaticPropsì—ì„œ ì˜ëª»ëœ ë°ì´í„°ë¥¼ ì»´í¬ë„ŒíŠ¸ì— ë‚´ë ¤ì¤€ë‹¤ë©´? ë°ì´í„°ê°€ ëˆ„ë½ëœ í˜ì´ì§€ì—ì„œ ì˜¤ë¥˜ ë°œìƒ => í˜ì´ì§€ë¥¼ í‘œì‹œí•˜ì§€ ì•Šê³  404 í˜ì´ì§€ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •

```tsx
function ProductDetailPage(props) {
  const { loadedProduct } = props;

  if (!loadedProduct) {
    return <p>Loading...</p>;
  }

  return (
    <>
      <h1>loadedProduct.title</h1>
    </>
  );
}

export async function getStaticProps(context) {
  const { params } = context;
  const productId = parmas.pid;

  const data = await getData();
  const product = data.products.find((product) => product.id === productId);

  if (!product) {
    return { notFound: true };
  }

  return {
    props: {
      loadedProduct: product,
    },
    revaildate: 60,
  };
}

export default async function getStaticPaths() {
  const data = await getData();

  const ids = data.products.map((product) => product.id);
  const pathsWithParams = ids.map((id) => ({ params: { pid: id } }));

  return {
    paths: pathsWithParams,
    fallback: true,
  };
}
```

### getStaticProps ì‹¤í–‰ ì‹œì  from Next.js ê³µì‹ë¬¸ì„œ

> https://nextjs.org/docs/pages/building-your-application/data-fetching/get-static-props#when-does-getstaticprops-run

- `getStaticProps`ëŠ” í•­ìƒ ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ë©° í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì ˆëŒ€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - í•­ìƒ `next build` ë™ì•ˆ ì‹¤í–‰ë©ë‹ˆë‹¤.
  - fallback: trueë¥¼ ì‚¬ìš©í•  ë•Œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
  - fallback: blockingì„ ì‚¬ìš©í•  ë•Œ getStaticPropsëŠ” ì´ˆê¸° ë Œë”ë§ ì „ì— í˜¸ì¶œë©ë‹ˆë‹¤.
  - revalidateë¥¼ ì‚¬ìš©í•  ë•Œ getStaticPropsëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
  - revalidate()ë¥¼ ì‚¬ìš©í•  ë•Œ getStaticPropsëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ í•„ìš”ì— ë”°ë¼ ì‹¤í–‰ë©ë‹ˆë‹¤.
- ì¦ë¶„ ì •ì  ì¬ìƒì„±(ISR, Incremental Static Regeneration)ê³¼ ê²°í•©í•˜ë©´, getStaticPropsëŠ” ì˜¤ë˜ëœ í˜ì´ì§€ê°€ ë‹¤ì‹œ ê²€ì¦ë˜ëŠ” ë™ì•ˆ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ë©°, ìµœì‹  í˜ì´ì§€ê°€ ë¸Œë¼ìš°ì €ì— ì œê³µë©ë‹ˆë‹¤.
- getStaticPropsëŠ” ì •ì  HTMLì„ ìƒì„±í•˜ë¯€ë¡œ request(ì˜ˆ: ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ ë˜ëŠ” HTTP í—¤ë”)ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ì— ëŒ€í•œ ìš”ì²­ì— ì ‘ê·¼í•´ì•¼ í•˜ëŠ” ê²½ìš° getStaticPropsì™€ í•¨ê»˜ ë¯¸ë“¤ì›¨ì–´(Middleware)ë¥¼ ì‚¬ìš© ê³ ë ¤

### ì •ì  ìƒì„± with ISR, ê·¸ë¦¬ê³  ì„œë²„ ì‚¬ì´ë“œ ëœë”ë§

> ì™œ í•œêµ­ì–´ë¡œ `ì¦ë¶„ ì •ì  ì¬ìƒì„±`ì´ ì•„ë‹ˆë¼ `ì¦ë¶„ ì •ì  ìƒì„±`ì¼ê¹Œ?

ì •ì  ìƒì„± and ISRëŠ” ì£¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•  ë•Œ ì‚¬ìš©í•œë‹¤. "get"StaticPropsë‹¤. requestì— ëŒ€í•´ ì ‘ê·¼í•  ë°©ë²•ì´ ì—†ë‹¤.

í•˜ì§€ë§Œ ì •ì  ìƒì„± ë¿ë§Œ ì•„ë‹ˆë¼, ëª¨ë“  requestì— ëŒ€í•´ ì‚¬ì „ ëœë”ë§ì„ í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ex) cookie ì•¡ì„¸ìŠ¤

Next.jsëŠ” ì° ì„œë²„ì‚¬ì´ë“œ ëœë”ë§ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤. ë¹Œë“œ ì‹œê°„ì´ë‚˜ íŠ¹ì • ì‹œê°„ë§ˆë‹¤ ì‚¬ì „ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ -> ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ í›„, ì„œë²„ì— ìœ ì…ë˜ëŠ” ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ì„œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ë¥¼ ì œê³µ

ì–´ë–»ê²Œ? getServerSideProps!

í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ íŒŒì¼ì— getServerSideProps í•¨ìˆ˜ê°€ ìˆë‹¤ë©´, NextJSëŠ” í•´ë‹¹ í˜ì´ì§€ì— ëŒ€í•œ requestê°€ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.

getStaticPropsì™€ ë™ì¼í•œ ì—­í• : ì»´í¬ë„ŒíŠ¸ì˜ í”„ë¡œí¼í‹°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜

### getServerSideProps

- ì‚¬ìš©ì²˜
  - ì¿ í‚¤: ì¿ í‚¤ì— ì•¡ì„¸ìŠ¤í•  ë•Œ, ì¿ í‚¤ë‘ ë¡œê·¸ì¸ ìš”ì²­ ì‚¬ìš©ìë¥¼ ë¯¸ë¦¬ ì•Œ ìˆ˜ ì—†ë‹¤.
    - getStaticPropsì™€ í˜•íƒœëŠ” ìœ ì‚¬í•œë° revaildateí•˜ì§€ ì•Šê³ , ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì‹¤í–‰
  - ë°ì´í„°ê°€ ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨ ë˜ì–´ì•¼ í•  ë•Œ (ì •ì  ìƒì„±ì´ í•„ìš”í•˜ì§€ ì•Šì€ ì¼€ì´ìŠ¤)

contextì˜ requestì— ì•¡ì„¸ìŠ¤ ê°€ëŠ¥! Node.js req, res íƒ€ì…ì´ë‹¤.

getStaticPathsëŠ” í•„ìš”ì—†ë‹¤. ì™œëƒ? ì„œë²„ì—ì„œë§Œ ì‘ë™í•˜ë¯€ë¡œ ì‚¬ì„  ìƒì„±í•  í•„ìš”ê°€ ì—†ê³  & ì‚¬ì „ ìƒì„±í•˜ì§€ ì•ŠìŒ

- ì‚¬ì „ ìƒì„±X, ì‚¬ì „ ëœë”ë§O

ë¹Œë“œ ì‹œ ëŒë‹¤ ê¸°í˜¸ê°€ ìˆëŠ” í˜ì´ì§€ë“¤ì€ ì‚¬ì „ ìƒì„±ì€ í•˜ì§€ ì•Šì•˜ê³ , ì‚¬ì „ ëœë”ë§ì´ ì§„í–‰ëœ í˜ì´ì§€ë‹¤.

```tsx
export async function getServerSideProps(context) {
  const { params, req, res } = context;

  return {
    props: {
      userName: "Max",
    },
  };
}
```

### ì‚¬ì „ íŒ¨ì¹­, í”„ë¦¬ íŒ¨ì¹­ pre fetching

build process ë•Œ, server sideì—ì„œ ë°ì´í„°ë¥¼ íŒ¨ì¹­í•œë‹¤. ISRë‚˜ SSRë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸ ê°€ëŠ¥

í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì™„ì„±ëœ í˜ì´ì§€ë¥¼ ì „ë‹¬í•´ì„œ UXë¥¼ ë†’ì´ê±°ë‚˜, SEOë¥¼ ê°œì„ í•˜ëŠ” ê²ƒì´ ëª©ì 

### í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë°ì´í„° íŒ¨ì¹­ì˜ í•„ìš”ì„±

- ê°±ì‹  ì£¼ê¸°ê°€ ì¦ì€ ë°ì´í„°: ì„œë²„ ì‚¬ì´ë“œì—ì„œ íŒ¨ì¹­í•˜ëŠ” ê²ƒì€ ì˜ë¯¸ê°€ ì—†ë‹¤. ex) ì£¼ì„ ë°ì´í„°
- ìœ ì € íŠ¹ì •ëœ ë°ì´í„°: SEO ê°œì„  ì—¬ì§€ê°€ ì—†ìŒ ex) ì£¼ë¬¸í™•ì¸, í”„ë¡œí•„
- ë¶€ë¶„ ë°ì´í„°: í˜ì´ì§€ ë‚´ ì—¬ëŸ¬ ë¶€ë¶„ì ì¸ apiì½œì´ ìˆëŠ” ê²½ìš°, ì„œë²„ì—ì„œ ì‚¬ì „ ëœë”ë§ì´ ì§€ì—°ë  ê°€ëŠ¥ì„±ì´ ìˆë‹¤. ex) ëŒ€ì‹œë³´ë“œ

### Client side data fetch ì˜ˆì‹œ

```tsx
import { useEffect, useState } from "react";

export default function LastSalesPage() {
  const [sales, setSales] = useState();
  const [isLoading, setLoading] = useState(false);

  useEffect(() => {
    const fetchSales = async () => {
      setLoading(true);
      try {
        const res = await fetch("https://~~");
        const data = await res.json();

        const transformedSales = [];

        for (const key in data) {
          transformedSales.push({ id: key, username: data[key].username });
        }

        setSales(transformedSales);
      } catch (error) {
        console.error("Failed to fetch sales data:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchSales();
  }, []);

  if (!isLoading) {
    return <>Loading...</>;
  }

  if (!sales) {
    return <>no data</>; // í˜ì´ì§€ ìŠ¤ëƒ…ìƒ· ì—¬ê¸° => í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŒ¨ì¹­í•˜ê¸° ë•Œë¬¸ì— no dataë¡œ ì‚¬ì „ ëœë”ë§ ë¨
  }

  return (
    <ul>
      {sales.map((sale) => (
        <li key={sale.id}>{sale.username}</li>
      ))}
    </ul>
  );
}
```

### useSWR

Next.js íŒ€ì´ ê°œë°œí•œ ë¦¬ì•¡íŠ¸ í›… ë¼ì´ë¸ŒëŸ¬ë¦¬. stale-while-revalidate

ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- urlë¥¼ ì‹ë³„ìë¡œ ì‚¬ìš©. ì¤‘ë³µ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•ŠìŒ
- revaildate, focus ìë™ íŒ¨ì¹­ ë“± ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥

```tsx
import { useEffect, useState } from "react";
import useSWR from "swr";

export default function LastSalesPage() {
  const [sales, setSales] = useState();
  const { data, error } = useSWR("https://~~");

  useEffect(() => {
    if (data) {
      const transformedSales = [];

      for (const key in data) {
        transformedSales.push({ id: key, username: data[key].username });
      }

      setSales(transformedSales);
    }
  }, [data]);

  if (error) {
    return <>Fail to fetch</>;
  }

  if (!data || !sales) {
    return <>Loading...</>; // í˜ì´ì§€ ìŠ¤ëƒ…ìƒ· ì—¬ê¸° => í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŒ¨ì¹­í•˜ê¸° ë•Œë¬¸ì— Loading...ë¡œ ì‚¬ì „ ëœë”ë§ ë¨
  }

  return (
    <ul>
      {sales.map((sale) => (
        <li key={sale.id}>{sale.username}</li>
      ))}
    </ul>
  );
}
```

### ì‚¬ì „ íŒ¨ì¹­ & í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ íŒ¨ì¹­

- ì„œë²„ ì¸¡ì—ì„œ íŒ¨ì¹­: initial Data / ê¸°ì¡´ ë°ì´í„°, ì‚¬ì „ ëœë”ë§
- í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ íŒ¨ì¹­: ì—…ë°ì´íŠ¸ ë°ì´í„°, ì‹¤ì‹œê°„ì„±

```tsx
import { useEffect, useState } from "react";

export default function LastSalesPage(props) {
  const [sales, setSales] = useState(props.sales);
  const { data, error } = useSWR("https://~~");

  useEffect(() => {
    if (data) {
      const transformedSales = [];

      for (const key in data) {
        transformedSales.push({ id: key, username: data[key].username });
      }

      setSales(transformedSales);
    }
  }, [data]);

  if (error) {
    return <>Fail to fetch</>;
  }

  if (!data && !sales) {
    return <>Loading...</>;
  }

  return (
    <ul>
      {sales.map((sale) => (
        <li key={sale.id}>{sale.username}</li>
      ))}
    </ul>
  );
}

export async function getStaticProps() {
  const fetchSales = async () => {
    setLoading(true);
    try {
      const res = await fetch("https://~~");
      const data = await res.json();

      const transformedSales = [];

      for (const key in data) {
        transformedSales.push({ id: key, username: data[key].username });
      }

      return {
        props: { sales: transformedSales },
        revalidate: 10,
      };
    } catch (error) {
      console.error("Failed to fetch sales data:", error);
    } finally {
      setLoading(false);
    }
  };
}
```

### í”„ë¡œì íŠ¸ ë°ëª¨ë¥¼ í†µí•´ section 14 ì‚´í´ë³´ê¸°

ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ì „ì— ìƒê°í•´ì•¼ í•  ì ì´ ì ì  ëŠ˜ì–´ë‚œë‹¤.

#### pre fetch vs client side fetch

- search engine crawlerê°€ ì•Œì•„ì•¼ í•˜ëŠ” ì •ë³´ì¸ê°€? (íŠ¸ë˜í”½ì„ ìœ ë„í•´ì•¼ í•˜ëŠ”ê°€?)
- ì§§ì€ ê¸°ê°„ì— ì—¬ëŸ¬ë²ˆ ë°”ë€ŒëŠ”ê°€?
- ìœ ì € íŠ¹ì • ë°ì´í„°ì¸ê°€? ë˜ëŠ” ì¸ê°€ê°€ í•„ìš”í•œ í˜ì´ì§€ì¸ê°€?
- ë¶€ë¶„ ìš”ì²­ì´ ë§ê±°ë‚˜, ì‘ë‹µì— ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ìš”ì²­ì„ í¬í•¨í•œ í˜ì´ì§€ì¸ê°€?

#### ì‚¬ì „ ìƒì„± & ì‚¬ì „ ëœë”ë§ & ì„œë²„ ì‚¬ì´ë“œ ëœë”ë§

- ëª¨ë“  ìš”ì²­ë§ˆë‹¤ ì‚¬ì „ ëœë”ë§ì´ ë˜ì–´ì•¼ í•˜ëŠ”ê°€?
- ì‚¬ìš©ìì˜ requestì— ì•¡ì„¸ìŠ¤í•´ì•¼ í•˜ëŠ”ê°€?

#### ë°ì´í„° íŒ¨ì¹­ ìµœì í™”í•˜ê¸°

- ìœ íš¨ì„± ê²€ì‚¬ë¡œ ì—…ë°ì´íŠ¸ ì§„í–‰ => revaildate
- ì‚¬ì „ ìƒì„±ì€ ì£¼ìš” ë°ì´í„°ë§Œ ex) feature ì´ë²¤íŠ¸ë§Œ revaildate
- ì‚¬ì „ íŒ¨ì¹­ì„ ì‚¬ìš©í•´ì„œ ì´ˆê¸°ê°’ ì‚¬ìš©í•˜ê¸°
- ì‚¬ì „ ìƒì„±í•  í˜ì´ì§€ê°€ ë¶ˆí•„ìš”í•˜ê²Œ ë§ë‹¤ë©´? => ì„œë²„ ì‚¬ì´ë“œ ëœë”ë§
- SEOê°€ ì¤‘ìš”í•˜ì§€ ì•Šê³ , ë¹ ë¥¸ í˜ì´ì§€ ì„œë¹™ì´ í•„ìš”í•˜ë‹¤ë©´? => í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ëœë”ë§

### NextJS ì•± ìµœì í™”

#### í˜ì´ì§€ head ì¶”ê°€í•˜ê¸°

Head ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©í•˜ê¸°! JSX ì–´ë””ì— ìˆë“  ìƒê´€ì—†ë‹¤.

```tsx
import Head from "next/head";

...
return (
  <div>
    <Head>
      <title>{ë°ì´í„°.title}</title>
      <meta
        name="description"
        content={ë°ì´í„°.description}
      >
    </Head>
  </div>;
)
```

- ê¸°ë³¸ Head
  - \_app.jsëŠ”? application shell
  - \_document.jsëŠ”? DOM ìš”ì†Œ ì¶”ê°€í•  ë•Œ ì—¬ê¸°ì— ì“°ì

```tsx
<Layout>
  <Head>
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <title>í˜ì´ì§€ ê¸°ë³¸ íƒ€ì´í‹€</title> // Headë¥¼ ì¤‘ë³µìœ¼ë¡œ ì‘ì„±í•  ë•Œ ê°™ì€ ìš”ì†Œê°€ ìˆë‹¤ë©´
    ë®ì–´ì“´ë‹¤
    <meta ... />
  </Head>
</Layout>
```

### Image

special component => create multiple versions of the image on the fly => when requests are coming in!

- webp, avif, lazy loading
- í•„ìš”í•  ë•Œë§ˆë‹¤ ìµœì í™” => ìš”ì²­ì´ ìˆì„ ë•Œë§ˆë‹¤ ìµœì í™”
- widthë‘ heightëŠ” ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆ => element ì‚¬ì´ì¦ˆëŠ” CSSì—ê²Œ
