## Next-auth

### useSessioní›…

- ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸ì„ ë§ˆì¹˜ë©´ ì¿ í‚¤ê°€ ìƒì„±ëœë‹¤.
- `next-auth`ëŠ” `useSession`í›…ì„ ì œê³µí•´ ì¸ì¦ëœ ì‚¬ìš©ìì¸ì§€ íŒë³„í•  ìˆ˜ ìˆë‹¤.

  ```jsx
  import { useSession } from "next-auth/client";

  const [session, loading] = useSession();
  ```

- ë‘ ê°œì˜ ìš”ì†Œë¥¼ ê°€ì§„ ë°°ì—´ì„ ë°˜í™˜í•˜ëŠ”ë° ì²« ë²ˆì§¸ëŠ” ì„¸ì…˜ì˜ í™œì„± ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì„¸ì…˜ ê°ì²´ì´ê³ , ë‘ ë²ˆì§¸ëŠ” loadingìœ¼ë¡œ ì‚¬ìš©ìê°€ í˜„ì¬ í˜ì´ì§€ì— ë¡œê·¸ì¸ëœ ìƒíƒœì¸ì§€ë¥¼ í™•ì¸í•˜ëŠ” ê°’ì´ë‹¤.
- ë”°ë¼ì„œ ì´ ê°’ì„ í†µí•´ UIë¥¼ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆë‹¤.
  ```jsx
  <div>
    {!session && !loading &&
      <Link href="/auth">Login</Link>
    }
    {session && (
      <Link href="/profile">Profile</Link>
      <button>Logout</button>
    )}
  </div>
  ```

<br/>

### ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬

- next-authì—ì„œ ì œê³µí•˜ëŠ” `signOut`í•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•œë‹¤.
- í•´ë‹¹ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ ì¿ í‚¤ì™€ ì„¸ì…˜ ì •ë³´ë¥¼ ì‚­ì œí•œë‹¤.

  ```jsx
  import { signOut } from "next-auth/client";

  function Navigation() {
    function logoutHanlder() {
      signOut();
    }
    return <button onClick={logoutHandler}>Logout</button>;
  }
  ```

<br/>

### getSession

- `useSession`í›…ì„ í™œìš©í•œ loading ìƒíƒœëŠ” sessionì´ ë³€í•˜ì§€ ì•Šìœ¼ë©´ ì—¬ì „íˆ trueê°’ì„ ê°€ì§„ë‹¤.
- ì¦‰, ì„¸ì…˜ì´ ë³€ê²½ë˜ëŠ” ë¡œê·¸ì¸ ì²˜ë¦¬ì—ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” loadingì´ë‹¤.
- ë”°ë¼ì„œ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ì—ì„œ `getSession()`ìœ¼ë¡œ ë¡œë”© ì²˜ë¦¬ë¥¼ í•˜ê³  í˜ì´ì§€ë¥¼ ë³´í˜¸í•  ìˆ˜ ìˆë‹¤.

> ğŸ’¡ `getSession()`ì€ ì„œë²„ ì‚¬ì´ë“œì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜ì´ë‹¤.

<br/>

**í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ë¡œë”© ë° í˜ì´ì§€ ê°€ë“œ**

- `useEffect`, `useState`ì‚¬ìš©

```jsx
import { getSession } from "next-auth/client";
import { useEffect, useState } from "react";

export default function ProfilePage() {
	const [isLoading, setIsLoading] = useState(true);

	useEffect(() => {
	  getSession().then((session) => {
	    if (!session) {
		  // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸
	      window.location.href = "auth";
	    } else {
	      setIsLoading(false);
	    }
	  });
	}, []);

	if (isLoading) {
		return <p>loading...</p>
	}

	return ...

}
```

<br/>

**ì„œë²„ ì‚¬ì´ë“œì—ì„œ ë¡œë”© ë° í˜ì´ì§€ ê°€ë“œ**

- `getServerSideProps()`ì‚¬ìš©

```jsx
import { getSession } from "next-auth/client";

export default function ProfilePage(){
	return </UserProfile>
}

export async function getServerSideProps(context) {
	const session = await getSession({ req: context.req });

  if(!session) {
      return {
        redirect: {
          destination: '/auth',
          permanent: false
        }
      }
	}

	return {
		props: { session }
	}
}
```
